-- PRIVATE SERVER FORCE REJOIN | Bee Swarm Simulator
-- EXTREME VERSION - Clicks Leave for you, THEN teleports
-- CRITICAL: Place in AUTO-EXECUTE folder

local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local StarterGui = game:GetService("StarterGui")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- YOUR PRIVATE SERVER
local PLACE_ID = 1537690962
local PRIVATE_SERVER_CODE = "16707204235853911608327042947697"

repeat task.wait() until CoreGui:FindFirstChild('RobloxPromptGui')
local promptOverlay = CoreGui.RobloxPromptGui.promptOverlay

-- Function to click the Leave button programmatically
local function clickLeave()
    pcall(function()
        local errorPrompt = promptOverlay:WaitForChild("ErrorPrompt")
        local leaveBtn = errorPrompt:FindFirstChild("MessageArea", true):FindFirstChild("LeaveButton", true)
        if leaveBtn then
            -- Click using Roblox's input system
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            task.wait(0.1)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            
            -- Also try firing the button directly
            leaveBtn:Activate()
            print("âœ… Clicked Leave button")
        end
    end)
end

-- Function to teleport to private server
local function teleportPrivate()
    print("ðŸš€ Teleporting to private server...")
    pcall(function()
        TeleportService:TeleportToPrivateServer(PLACE_ID, PRIVATE_SERVER_CODE, {Players.LocalPlayer})
    end)
    
    -- Infinite retry
    while true do
        task.wait(3)
        TeleportService:TeleportToPrivateServer(PLACE_ID, PRIVATE_SERVER_CODE, {Players.LocalPlayer})
    end
end

-- Detect disconnection
promptOverlay.ChildAdded:Connect(function(child)
    if child.Name == 'ErrorPrompt' then
        print("ðŸš¨ Disconnected! Force rejoining...")
        
        -- Wait 1 second for UI to fully load
        task.wait(1)
        
        -- Click Leave first (this properly exits the broken state)
        clickLeave()
        
        -- Wait for game state to reset
        task.wait(3)
        
        -- Then teleport
        teleportPrivate()
    end
end)

-- If already disconnected
if promptOverlay:FindFirstChild('ErrorPrompt') then
    print("ðŸš¨ Already disconnected! Rejoining...")
    clickLeave()
    task.wait(3)
    teleportPrivate()
end

print("âœ… Private server script ACTIVE")
print("ðŸŽ¯ Server: " .. PRIVATE_SERVER_CODE)
print("ðŸ’¡ DO NOT click anything when disconnected!")
